# é¡¹ç›®ä¿®æ”¹è¯¦ç»†è®°å½• (Wiki)

æœ¬æ–‡æ¡£è¯¦ç»†è®°å½•äº†åŸºäº `NoFxAiOS/nofx` main åˆ†æ”¯ï¼ˆåŸå§‹ç‰ˆæœ¬ï¼‰è¿›è¡Œçš„è‡ªå®šä¹‰ä¿®æ”¹ã€‚

## 1. æ ¸å¿ƒäº¤æ˜“é€»è¾‘ä¿®æ”¹

### 1.1 æ”¯æŒ Hold çŠ¶æ€ä¸‹çš„æ­¢ç›ˆæ­¢æŸæ›´æ–°
**ä¿®æ”¹æ–‡ä»¶**: `trader/auto_trader.go`
**åŸé€»è¾‘**: å½“ AI å†³ç­–ä¸º `hold` æˆ– `wait` æ—¶ï¼Œç›´æ¥è¿”å›ï¼Œä¸æ‰§è¡Œä»»ä½•æ“ä½œã€‚
**æ–°é€»è¾‘**: åœ¨ `executeHoldWithRecord` æ–¹æ³•ä¸­å¢åŠ äº†é€»è¾‘ï¼Œå¦‚æœ AI å†³ç­–ä¸­åŒ…å«äº† `StopLoss` æˆ– `TakeProfit`ï¼Œå³ä½¿åŠ¨ä½œä¸º `hold`ï¼Œä¹Ÿä¼šå°è¯•æ›´æ–°å½“å‰æŒä»“çš„æ­¢ç›ˆæ­¢æŸè®¾ç½®ã€‚
**ä»£ç ç‰‡æ®µ**:
```go
// executeHoldWithRecord executes hold action but checks for updates (SL/TP)
func (at *AutoTrader) executeHoldWithRecord(decision *kernel.Decision, actionRecord *store.DecisionAction) error {
    // If StopLoss or TakeProfit is provided, update them
    if decision.StopLoss > 0 || decision.TakeProfit > 0 {
        // ... (æ›´æ–°æ­¢ç›ˆæ­¢æŸé€»è¾‘)
    }
    return nil
}
```

### 1.2 æ”¯æŒåˆ†æ‰¹æ­¢ç›ˆ (Partial Take Profit)
**ä¿®æ”¹æ–‡ä»¶**: `trader/auto_trader.go`
**åŸé€»è¾‘**: ä»…æ”¯æŒå®Œå…¨å¹³ä»“ (`close_long`, `close_short`)ã€‚
**æ–°é€»è¾‘**: 
1.  åœ¨ `executeDecisionWithRecord` ä¸­å¢åŠ äº† `partial_close` åŠ¨ä½œçš„æ”¯æŒã€‚
2.  æ–°å¢ `executePartialCloseWithRecord` æ–¹æ³•ï¼Œæ ¹æ® `decision.ClosePercentage` è®¡ç®—å¹³ä»“æ•°é‡ã€‚
3.  åœ¨ `executeCloseLongWithRecord` å’Œ `executeCloseShortWithRecord` ä¸­å¢åŠ äº†å¤„ç† `ClosePercentage` çš„é€»è¾‘ï¼Œæ”¯æŒæŒ‰æ¯”ä¾‹å¹³ä»“ã€‚

### 1.3 ç¦ç”¨å¼ºåˆ¶å›æ’¤å¹³ä»“æœºåˆ¶
**ä¿®æ”¹æ–‡ä»¶**: `trader/auto_trader.go`
**åŸé€»è¾‘**: åœ¨ `checkPositionDrawdown` æ–¹æ³•ä¸­ï¼Œå¦‚æœæŒä»“ç›ˆåˆ©è¶…è¿‡ 5% ä¸”åç»­å›æ’¤è¶…è¿‡ 40%ï¼Œä¼šå¼ºåˆ¶è§¦å‘ç´§æ€¥å¹³ä»“ï¼ˆ"Hidden Stop-Loss"ï¼‰ã€‚
**æ–°é€»è¾‘**: è¯¥å¼ºåˆ¶å¹³ä»“é€»è¾‘å·²è¢«æ³¨é‡Šæ‰ï¼Œä»…ä¿ç•™æ—¥å¿—è®°å½•ã€‚ç³»ç»Ÿä¸å†è‡ªåŠ¨å› å›æ’¤è€Œå¼ºåˆ¶å¹³ä»“ï¼Œå®Œå…¨äº¤ç”± AI å†³ç­–æˆ–è®¾ç½®çš„ç¡¬æ€§æ­¢æŸæ¥æ§åˆ¶ã€‚
**ä»£ç ç‰‡æ®µ**:
```go
// Check close position condition: profit > 5% and drawdown >= 40%
// [REMOVED BY USER REQUEST] "Hidden Stop-Loss" lock removed
// if currentPnLPct > 5.0 && drawdownPct >= 40.0 {
//     ...
// }
```

## 2. æ–°å¢åŠŸèƒ½æ¨¡å—

### 2.1 å†³ç­–å¯„å­˜å™¨ (Registers)
**æ–°å¢æ–‡ä»¶**: `kernel/register.go`
**ä¿®æ”¹æ–‡ä»¶**: `trader/auto_trader.go`
**åŠŸèƒ½æè¿°**: 
å¼•å…¥äº†â€œå¯„å­˜å™¨â€æ¦‚å¿µï¼Œç”¨äºå°† AI çš„å†å²å†³ç­–ã€æ‰§è¡ŒçŠ¶æ€å’Œå½“æ—¶çš„å¸‚åœºæ•°æ®ä¿å­˜ä¸º JSON æ–‡ä»¶ï¼ˆå­˜å‚¨åœ¨ `data/decision_history/`ï¼‰ã€‚è¿™å…è®¸ç³»ç»Ÿåœ¨åç»­çš„ Prompt ä¸­å¼•ç”¨ä¹‹å‰çš„å†³ç­–ä¸Šä¸‹æ–‡ï¼Œå¢å¼º AI çš„è¿ç»­æ€§æ€ç»´èƒ½åŠ›ã€‚
**å®ç°ç»†èŠ‚**:
-   `kernel/register.go`: å®šä¹‰äº† `Register` ç»“æ„ä½“ï¼Œå®ç°äº†è®°å½•çš„åŠ è½½ã€ä¿å­˜å’Œ Prompt æ„å»ºã€‚
-   `trader/auto_trader.go`: åœ¨ `runCycle` ç»“æŸå‰ï¼Œè°ƒç”¨å¯„å­˜å™¨ä¿å­˜å½“å‰å‘¨æœŸçš„å®Œæ•´ä¸Šä¸‹æ–‡ã€‚

### 2.2 Telegram äº¤äº’æœºå™¨äºº
**æ–°å¢ç›®å½•**: `telegram/`
**æ–°å¢æ–‡ä»¶**: `telegram/bot.go`
**ä¿®æ”¹æ–‡ä»¶**: `main.go`
**åŠŸèƒ½æè¿°**: 
é›†æˆäº†ä¸€ä¸ª Telegram Botï¼Œç”¨äºå®æ—¶æ¥æ”¶äº¤æ˜“é€šçŸ¥å’Œè¿›è¡Œç®€å•çš„äº¤äº’æŸ¥è¯¢ã€‚
**ä¸»è¦åŠŸèƒ½**:
-   **å®æ—¶é€šçŸ¥**: æ¯å½“ AI å®Œæˆä¸€æ¬¡å†³ç­–å‘¨æœŸï¼ŒBot ä¼šå‘æŒ‡å®š Chat ID å‘é€åŒ…å«å†³ç­–ç»“æœã€ç†ç”±å’Œæ€ç»´é“¾ï¼ˆCoTï¼‰çš„é€šçŸ¥ã€‚
-   **å‘½ä»¤äº¤äº’**: æ”¯æŒ `/status` (æŸ¥çœ‹çŠ¶æ€), `/balance` (æŸ¥çœ‹ä½™é¢), `/positions` (æŸ¥çœ‹æŒä»“) ç­‰å‘½ä»¤ã€‚
**å®ç°ç»†èŠ‚**:
-   `telegram/bot.go`: å®ç°äº† Bot çš„æ ¸å¿ƒé€»è¾‘ï¼ŒåŒ…æ‹¬æ¶ˆæ¯å¤„ç†å’Œæ ¼å¼åŒ–ã€‚
-   `main.go`: åœ¨ç³»ç»Ÿå¯åŠ¨æ—¶åˆå§‹åŒ–å¹¶å¯åŠ¨ Telegram Botã€‚

## 3. å…¶ä»–ä¿®æ”¹

### 3.1 ç§»é™¤ WebSocket è¡Œæƒ…ä¾èµ–
**ä¿®æ”¹æ–‡ä»¶**: `main.go`
**æè¿°**: æ³¨é‡Šæ‰äº† `market.NewWSMonitor` çš„å¯åŠ¨ä»£ç ï¼Œå¹¶æ·»åŠ æ—¥å¿— "Using CoinAnk API for all market data (WebSocket cache disabled)"ã€‚ç°åœ¨ç³»ç»Ÿå®Œå…¨ä¾èµ– CoinAnk API è·å– K çº¿æ•°æ®ï¼Œå‡å°‘äº†è¿æ¥ç»´æŠ¤å¼€é”€ã€‚

### 3.2 ä¾èµ–åº“æ›´æ–°
**ä¿®æ”¹æ–‡ä»¶**: `go.mod`, `go.sum`
**æè¿°**: å¼•å…¥äº† `github.com/go-telegram-bot-api/telegram-bot-api/v5` ç­‰æ–°ä¾èµ–ä»¥æ”¯æŒ Telegram åŠŸèƒ½ã€‚

### 3.3 æ•°æ®å­—å…¸ä¸äº¤æ˜“è§„åˆ™æ›´æ–°
**ä¿®æ”¹æ–‡ä»¶**: `kernel/schema.go`, `kernel/engine.go`
**æè¿°**: 
1.  **æ‰©å±• Action å­—æ®µ**: æ›´æ–°äº†æ•°æ®å­—å…¸ä¸­çš„ `Action` æè¿°ï¼Œæ˜ç¡®æ”¯æŒ `open_long`, `open_short`, `close_long`, `close_short`, `partial_close`, `hold`, `wait` ç­‰åŠ¨ä½œã€‚
2.  **æ–°å¢ ClosePercentage å­—æ®µ**: åœ¨ `PositionMetrics` ä¸‹æ–°å¢äº† `ClosePercentage` å­—æ®µå®šä¹‰ï¼Œç”¨äºæ”¯æŒåˆ†æ‰¹æ­¢ç›ˆç­–ç•¥ï¼ˆ0.5 è¡¨ç¤ºå¹³ä»“ 50%ï¼‰ã€‚
3.  **æ–°å¢ RegisterMetrics æ•°æ®å­—å…¸**: å®šä¹‰äº† `Cycle`, `MarketRegime`, `ExecutionStatus`, `Decisions` ç­‰å¯„å­˜å™¨å­—æ®µï¼Œä½¿ AI èƒ½å¤Ÿç†è§£å†å²è®°å½•ï¼ˆè®°å¿†æ¨¡å—ï¼‰çš„å«ä¹‰ã€‚
4.  **Prompt åŒæ­¥**: ä¸Šè¿°ä¿®æ”¹ä¼šè‡ªåŠ¨åæ˜ åœ¨ `GetSchemaPrompt` ç”Ÿæˆçš„ç³»ç»Ÿ Prompt ä¸­ï¼Œç¡®ä¿ AI èƒ½å¤Ÿç†è§£æœ€æ–°çš„äº¤æ˜“æŒ‡ä»¤é›†å’Œå¯„å­˜å™¨å†…å®¹ã€‚
5.  **Trader ID ä¿®å¤**: ä¿®å¤äº† `kernel/engine.go` å’Œ `trader/auto_trader.go` ä¸­ä¸Šä¸‹æ–‡ä¼ é€’ Trader ID çš„é—®é¢˜ï¼Œç¡®ä¿æ¯ä¸ªäº¤æ˜“å‘˜è¯»å–æ­£ç¡®çš„å¯„å­˜å™¨å†å²ã€‚

### 3.4 å¯„å­˜å™¨ Prompt ä¼˜åŒ–
**ä¿®æ”¹æ–‡ä»¶**: `kernel/register.go`
**æè¿°**: å°†å¯„å­˜å™¨å†å²è®°å½•çš„æ ‡é¢˜ä» `## å†å²å†³ç­–è®°å½•` ä¿®æ”¹ä¸º **`## ğŸ§  å†³ç­–å¯„å­˜å™¨ (Memory Bank)`**ï¼Œå¹¶é…åˆ System Prompt ä¸­çš„æ•°æ®å­—å…¸ï¼Œä½¿ AI èƒ½å¤Ÿæ›´ç²¾å‡†åœ°è¯†åˆ«å’Œåˆ©ç”¨å†å²å†³ç­–æ•°æ®ä½œä¸ºé•¿æœŸè®°å¿†ã€‚

### 3.5 AI Prompt æ€§èƒ½ä¼˜åŒ–ä¸è‡ªé€‚åº”æ˜¾ç¤º
**ä¿®æ”¹æ–‡ä»¶**: `kernel/engine.go`, `store/strategy.go`
**æè¿°**:
1.  **Token æ¶ˆè€—ä¼˜åŒ–**: é‡æ„äº†å¸‚åœºæ•°æ®æ ¼å¼åŒ–é€»è¾‘ (`formatTimeframeSeriesData`)ï¼Œå°† Prompt ä¸­å±•ç¤ºçš„ K çº¿æ•°é‡ä¸åç«¯æŒ‡æ ‡è®¡ç®—æ‰€éœ€çš„ K çº¿æ•°é‡è§£è€¦ã€‚
    *   åç«¯è®¡ç®—ï¼šå§‹ç»ˆä½¿ç”¨é…ç½®çš„å®Œæ•´æ•°é‡ï¼ˆå¦‚ 100 æ ¹ï¼‰ä»¥ç¡®ä¿ EMA/MACD æŒ‡æ ‡ç²¾å‡†ã€‚
    *   å‰ç«¯å±•ç¤ºï¼šé»˜è®¤æˆªæ–­ä¸ºä¸»å‘¨æœŸ 24 æ ¹ã€è¾…å‘¨æœŸ 12 æ ¹ï¼Œå¤§å¹…é™ä½ Token æ¶ˆè€—ï¼ˆ~60-70%ï¼‰ã€‚
2.  **è‡ªé€‚åº”å‚æ•° (`DisplayCount`)**:
    *   åœ¨ `StrategyConfig` ä¸­æ–°å¢ `display_count` å­—æ®µã€‚
    *   æ”¯æŒç”¨æˆ·åœ¨ç­–ç•¥ JSON ä¸­è‡ªå®šä¹‰å±•ç¤ºæ•°é‡ï¼ˆå¦‚ 50 æˆ– 300ï¼‰ï¼Œç³»ç»Ÿä¼šè‡ªåŠ¨é€‚é…ã€‚è‹¥æœªè®¾ç½®ï¼Œåˆ™å¯ç”¨é»˜è®¤çš„æ™ºèƒ½æˆªæ–­é€»è¾‘ã€‚
3.  **å»é‡**: ä¿®å¤äº† System Prompt ä¸ Custom Prompt è§„åˆ™é‡å¤å¯¼è‡´ä¸Šä¸‹æ–‡å†—ä½™çš„é—®é¢˜ã€‚

### 3.6 Prompt Data Format Optimization
**ä¿®æ”¹æ–‡ä»¶**: `kernel/engine.go`
**æè¿°**:
1.  **ç´§å‡‘ CSV æ ¼å¼**: å°† K çº¿æ•°æ®çš„å±•ç¤ºæ ¼å¼ä»å¯¹é½è¡¨æ ¼ï¼ˆå›ºå®šå®½åº¦ï¼‰æ”¹ä¸ºç´§å‡‘çš„ CSV æ ¼å¼ï¼ˆé€—å·åˆ†éš”ï¼‰ï¼Œå¤§å¹…å‡å°‘äº†ç”±ç©ºæ ¼å¡«å……å¯¼è‡´çš„ Token æ¶ˆè€—ã€‚
2.  **æ™ºèƒ½æµ®ç‚¹æ•°æ ¼å¼åŒ–**: å®ç°äº† `formatPriceSmart` å’Œ `formatVolumeSmart` å‡½æ•°ï¼Œæ ¹æ®æ•°å€¼å¤§å°åŠ¨æ€è°ƒæ•´å°æ•°ç²¾åº¦ï¼ˆå¦‚å°æ•°å€¼ä¿ç•™ 8 ä½ï¼Œå¤§æ•°å€¼ä¿ç•™ 2 ä½ï¼‰ï¼Œé¿å…äº†å†—ä½™ç²¾åº¦ï¼ˆå¦‚ `0.000000` -> `0`ï¼‰ã€‚
3.  **æ•°ç»„å‹ç¼©**: ä¼˜åŒ–äº†æŒ‡æ ‡æ•°ç»„ï¼ˆEMA, MACD, RSIï¼‰çš„å±•ç¤ºï¼Œç§»é™¤äº†æ–¹æ‹¬å·å’Œé€—å·ï¼Œæ”¹ç”¨ç©ºæ ¼åˆ†éš”ï¼Œè¿›ä¸€æ­¥èŠ‚çœ Tokenã€‚

### 3.7 System Prompt Schema Optimization
**ä¿®æ”¹æ–‡ä»¶**: `kernel/schema.go`, `kernel/engine.go`
**æè¿°**:
1.  **è‹±æ–‡æ•°æ®å­—å…¸**: å°† System Prompt ä¸­çš„æ•°æ®å­—å…¸ï¼ˆSchemaï¼‰ä»è¯¦ç»†çš„åŒè¯­å¯¹ç…§æ”¹ä¸ºç²¾ç®€çš„è‹±æ–‡å®šä¹‰ï¼ˆå¦‚ `UnrealizedPnL(Floating)`ï¼‰ï¼Œå‡å°‘äº†çº¦ 60% çš„ Schema Token æ¶ˆè€—ã€‚
2.  **å¼ºåˆ¶ä¸­æ–‡å›å¤**: åœ¨ `engine.go` çš„ Prompt æ„å»ºé€»è¾‘ä¸­ï¼Œå¢åŠ äº†é’ˆå¯¹ä¸­æ–‡ç¯å¢ƒçš„å¼ºåˆ¶æŒ‡ä»¤ `IMPORTANT: Please analyze and respond STRICTLY in Chinese language`ï¼Œç¡®ä¿å³ä½¿è¾“å…¥è‹±æ–‡å®šä¹‰ï¼ŒAI ä»ç”¨ä¸­æ–‡å›å¤ã€‚
3.  **Wiki æ–‡æ¡£æ”¯æŒ**: è‡ªåŠ¨ç”Ÿæˆäº† `docs/wiki/DATA_DICTIONARY.md`ï¼Œæä¾›ä¸­è‹±æ–‡æœ¯è¯­å¯¹ç…§è¡¨ï¼Œæ–¹ä¾¿å¼€å‘è€…æŸ¥é˜…ã€‚

### 3.8 Configurable Risk & Strategy Rules
**ä¿®æ”¹æ–‡ä»¶**: `kernel/schema.go`, `docs/wiki/DATA_DICTIONARY.md`
**æè¿°**:
1.  **ç§»é™¤ç¡¬ç¼–ç è§„åˆ™**: ä» System Prompt (`kernel/schema.go`) ä¸­å½»åº•ç§»é™¤äº†ç¡¬ç¼–ç çš„é£é™©æ§åˆ¶ (Risk Management) å’Œç­–ç•¥åŸåˆ™ (Strategy) è§„åˆ™ï¼ˆå¦‚ "Max Margin 30%", "Only add to winners"ï¼‰ã€‚
2.  **é…ç½®é©±åŠ¨**: å°†é£æ§å’Œç­–ç•¥é€»è¾‘çš„æ§åˆ¶æƒå®Œå…¨äº¤è¿˜ç»™ç”¨æˆ·ã€‚ç°åœ¨ï¼ŒAI çš„è¡Œä¸ºå®Œå…¨å–å†³äºç­–ç•¥é…ç½®æ–‡ä»¶ (`strategy_*.json`) ä¸­çš„ `entry_standards` å’Œ `decision_process` å­—æ®µï¼Œå®ç°äº†çœŸæ­£çš„ç­–ç•¥åŠ¨æ€é…ç½®ã€‚
3.  **æ–‡æ¡£æ›´æ–°**: åœ¨ Wiki æ–‡æ¡£ä¸­æ ‡è®°äº†è¿™äº›è§„åˆ™å·²ä»åº•å±‚ç§»é™¤ï¼Œå¹¶æä¾›äº†é…ç½®å»ºè®®ã€‚

## 4. ç³»ç»Ÿç¨³å®šæ€§ä¸åŠŸèƒ½å¢å¼º [2026-02-14]

### 4.1 Telegram Bot é‡æ„ä¸é…ç½®é›†æˆ
**ä¿®æ”¹æ–‡ä»¶**: `telegram/bot.go`, `config/config.go`, `main.go`, `.env`
**æè¿°**: 
1.  **ä»£ç é‡æ„**: ä¼˜åŒ–äº† Bot çš„åˆå§‹åŒ–é€»è¾‘ï¼Œä½¿å…¶æ›´ç¬¦åˆé¡¹ç›®æ•´ä½“æ¶æ„ã€‚
2.  **é…ç½®é›†æˆ**: å°† Bot Token å’Œ User ID ä»ä»£ç ä¸­å‰¥ç¦»ï¼Œç»Ÿä¸€é€šè¿‡ `config` åŒ…è¯»å–ç¯å¢ƒå˜é‡ (`TELEGRAM_BOT_TOKEN`, `TELEGRAM_USER_ID`)ã€‚
3.  **å¯åŠ¨é›†æˆ**: åœ¨ `main.go` ä¸­æ­£å¼é›†æˆ Bot å¯åŠ¨æµç¨‹ï¼Œç¡®ä¿éšä¸»ç¨‹åºä¸€åŒè¿è¡Œã€‚

### 4.2 ä¿®å¤ Hold çŠ¶æ€ä¸‹çš„è®¢å•æ›´æ–°é€»è¾‘
**ä¿®æ”¹æ–‡ä»¶**: `trader/auto_trader.go`
**æè¿°**: 
ä¿®å¤äº†åœ¨ `Hold` çŠ¶æ€ä¸‹å°è¯•æ›´æ–°æ­¢æŸ/æ­¢ç›ˆæ—¶ï¼Œå› æœªå…ˆæ’¤é”€æ—§è®¢å•è€Œå¯¼è‡´ Binance æŠ¥é”™ `-4130` (Existing Order) çš„é—®é¢˜ã€‚
**æ–°é€»è¾‘**: å¼•å…¥â€œå…ˆæ’¤åè®¾â€æœºåˆ¶ï¼Œç¡®ä¿æ–°è®¢å•èƒ½æ­£ç¡®è¦†ç›–æ—§è®¢å•ã€‚

### 4.3 ä¿®å¤ Partial Close è®¢å•æ›´æ–°ä¸å®‰å…¨éšæ‚£
**ä¿®æ”¹æ–‡ä»¶**: `trader/auto_trader.go`, `trader/binance/futures.go`
**æè¿°**: 
1.  **é€»è¾‘è¡¥å…¨**: å®Œå–„äº†åˆ†æ‰¹å¹³ä»“ (`Partial Close`) é€»è¾‘ã€‚ç°åœ¨æ‰§è¡Œåˆ†æ‰¹å¹³ä»“åï¼Œä¼šè‡ªåŠ¨æ›´æ–°å‰©ä½™ä»“ä½çš„æ­¢æŸ/æ­¢ç›ˆè®¾ç½®ï¼ˆå¦‚æœ‰ï¼‰ã€‚
2.  **é‡å¤§ Bug ä¿®å¤**: ä¿®æ­£äº† Binance æ¥å£é©±åŠ¨ä¸­ `CloseLong/CloseShort` æ— æ¡ä»¶æ’¤é”€æ‰€æœ‰æŒ‚å•çš„ç¼ºé™·ã€‚
    - **ä¿®å¤å‰**: æ— è®ºå¹³å¤šå°‘ä»“ä½ï¼Œéƒ½ä¼šæ’¤é”€è¯¥å¸ç§æ‰€æœ‰æŒ‚å•ï¼Œå¯¼è‡´å‰©ä½™ä»“ä½â€œè£¸å¥”â€ã€‚
    - **ä¿®å¤å**: ä»…åœ¨å…¨ä»“å¹³ä»“ (`Full Close`) æ—¶æ’¤é”€æŒ‚å•ï¼›åˆ†æ‰¹å¹³ä»“æ—¶ä¿ç•™ç°æœ‰æ­¢æŸ/æ­¢ç›ˆå•ï¼Œç¡®ä¿å®‰å…¨ã€‚

### 4.4 æ„å»ºç³»ç»Ÿä¼˜åŒ–
**ä¿®æ”¹æ–‡ä»¶**: `.github/workflows/docker-build.yml`, `Dockerfile`
**æè¿°**: 
1.  **æ„å»ºä¿®å¤**: è§£å†³äº† `go mod tidy` åœ¨ Docker æ„å»ºä¸­çš„å…¼å®¹æ€§é—®é¢˜ã€‚
2.  **èµ„æºä¼˜åŒ–**: åœ¨ GitHub Actions ä¸­å¯ç”¨äº† `max-parallel: 1` ç­–ç•¥ï¼Œé¿å…äº†å› å¹¶è¡Œæ„å»ºå¯¼è‡´çš„èµ„æºè€—å°½å’Œè¶…æ—¶å¤±è´¥ã€‚
3.  **ç¯å¢ƒå¯¹é½**: åŒæ­¥äº† `main` ä¸ `test` åˆ†æ”¯çš„æ„å»ºç¯å¢ƒï¼Œç¡®ä¿ç”Ÿäº§ç¯å¢ƒç¨³å®šæ€§ã€‚

### 4.5 è®°å¿†è§£æå‡çº§ (Memory Audit Upgrade)
**ä¿®æ”¹æ–‡ä»¶**: `kernel/engine.go`, `trader/auto_trader.go`, `kernel/register.go`
**æè¿°**: 
1.  **æ•°æ®å±‚**: åœ¨ `Decision` ç»“æ„ä½“ä¸­æ–°å¢ `EntryPrice` å­—æ®µï¼Œç”¨äºè®°å½•å†³ç­–å½“æ—¶çš„æŒä»“å‡ä»·ã€‚
2.  **æ‰§è¡Œå±‚**: åœ¨ `auto_trader` ç”Ÿæˆå†³ç­–è®°å½•æ—¶ï¼Œè‹¥å½“å‰æŒæœ‰ç›¸åº”ä»“ä½ï¼Œåˆ™è‡ªåŠ¨æŠ“å– `Position.EntryPrice` å¹¶å¡«å……åˆ°å†³ç­–è®°å½•ä¸­ã€‚
3.  **è®¤çŸ¥å±‚**: ä¼˜åŒ–äº† Prompt ä¸­â€œå†³ç­–å¯„å­˜å™¨â€çš„å±•ç¤ºæ ¼å¼ï¼Œåœ¨ Hold/Open è®°å½•ä¸­æ˜¾å¼å±•ç¤º `Entry: xxx`ï¼Œä½¿ AI èƒ½å¤Ÿè¿›è¡Œå‡†ç¡®çš„ç›ˆäºå®¡è®¡å’Œåæ€ã€‚

---

## 5. æ–°å¢åŠŸèƒ½æ¨¡å— [2026-02-15]

### 5.1 ADX (å¹³å‡æ–¹å‘æŒ‡æ•°) æŒ‡æ ‡é›†æˆ
**ä¿®æ”¹æ–‡ä»¶**: `market/adx.go`, `market/data.go`, `market/types.go`, `kernel/engine.go`, `store/strategy.go`, `web/src/components/strategy/IndicatorEditor.tsx`
**æè¿°**: 
1.  **æ ¸å¿ƒè®¡ç®—**: å®ç°äº† Wilder's Smoothing ç®—æ³•è®¡ç®— ADX, DI+, DI- (`market/adx.go`)ã€‚
2.  **æ•°æ®æµ**: å°† ADX é›†æˆåˆ° Market Data æµç¨‹ä¸­ï¼Œæ”¯æŒä» 1m åˆ° 1d æ‰€æœ‰å‘¨æœŸçš„è®¡ç®—ã€‚
3.  **AI æ„ŸçŸ¥**: æ›´æ–°äº† `kernel/engine.go`ï¼Œå½“ç­–ç•¥å¼€å¯ `EnableADX` æ—¶ï¼Œè‡ªåŠ¨å°† ADX å€¼æ³¨å…¥ System Promptã€‚
4.  **å‰ç«¯æ”¯æŒ**: åœ¨ç­–ç•¥ç¼–è¾‘å™¨ä¸­å¢åŠ äº† ADX å¼€å…³å’Œå‘¨æœŸé…ç½®ï¼ˆé»˜è®¤ 14ï¼‰ã€‚
5.  **é…ç½®æ”¯æŒ**: ç­–ç•¥é…ç½®æ–‡ä»¶ (`store/strategy.go`) æ–°å¢ `EnableADX` å’Œ `ADXPeriods` å­—æ®µã€‚

### 5.2 Wiki æ–‡æ¡£ç³»ç»Ÿå‡çº§
**æ–°å¢æ–‡ä»¶**: `docs/wiki/INDICATORS.md`, `docs/wiki/README.md`
**ä¿®æ”¹æ–‡ä»¶**: `web/src/components/landing/FooterSection.tsx`
**æè¿°**: 
1.  **æŒ‡æ ‡åº“æ–‡æ¡£**: åˆ›å»ºäº† `INDICATORS.md`ï¼Œè¯¦ç»†è®°å½•äº†æ‰€æœ‰æ”¯æŒçš„æŒ‡æ ‡ï¼ˆADX, EMA, MACD, RSI, ATR, BOLL ç­‰ï¼‰çš„é…ç½®å‚æ•°ã€é»˜è®¤å€¼åŠ Prompt å‘ˆç°æ ¼å¼ï¼ˆä¸­æ–‡ç‰ˆï¼‰ã€‚
2.  **Wiki ç´¢å¼•**: åˆ›å»ºäº†é¦–é¡µç´¢å¼• `README.md`ã€‚
3.  **å…¥å£é›†æˆ**: åœ¨ç½‘ç«™é¡µè„š (Footer) æ–°å¢äº† "Wiki / æŒ‡æ ‡è¯´æ˜" é“¾æ¥ï¼Œæ–¹ä¾¿ç”¨æˆ·æŸ¥é˜…ã€‚

## 6. æ–°å¢åŠŸèƒ½æ¨¡å— [2026-02-16]

### 6.1 Global Market Context (å…¨å±€å¸‚åœºèƒŒæ™¯)
**ä¿®æ”¹æ–‡ä»¶**: `kernel/engine.go`, `kernel/formatter.go`
**æè¿°**: 
1.  **å¼ºåˆ¶ BTC æ•°æ®è·å–**: ä¿®æ”¹ `kernel/engine.go`ï¼Œåœ¨è·å–å¸‚åœºæ•°æ®æ—¶ï¼Œæ— è®ºå½“å‰ç­–ç•¥å¦‚ä½•é…ç½®ï¼Œ**å§‹ç»ˆå¼ºåˆ¶è·å– BTCUSDT çš„ K çº¿æ•°æ®**å¹¶åŠ å…¥ `MarketDataMap`ã€‚
2.  **Prompt å¤´éƒ¨å±•ç¤º**: ä¿®æ”¹ `kernel/formatter.go`ï¼Œåœ¨ System Prompt çš„æœ€é¡¶éƒ¨ï¼ˆHeader ä¹‹åï¼‰æ’å…¥ "Global Market Context" ç‰ˆå—ï¼Œå±•ç¤º BTCUSDT çš„ä»·æ ¼ã€15m/1h/4h æ¶¨è·Œå¹…å’Œ ADXã€‚
3.  **ç›®çš„**: ç¡®ä¿ AI åœ¨åˆ†æä»»ä½•å¸ç§ï¼ˆå¦‚ ETH, SOLï¼‰æ—¶ï¼Œéƒ½èƒ½è·å¾— BTC çš„å®æ—¶æ•°æ®ä½œä¸ºâ€œå…¨å±€æŒ‡æŒ¥â€åˆ¤æ–­çš„ä¾æ®ï¼Œå½»åº•è§£å†³äº† `prompt23.yaml` ä¸­å…¨å±€æŒ‡æŒ¥é€»è¾‘çš„æ•°æ®ä¾èµ–é—®é¢˜ã€‚

### 6.2 15m Price Change (15åˆ†é’Ÿæ¶¨è·Œå¹…)
**ä¿®æ”¹æ–‡ä»¶**: `market/types.go`, `market/data.go`, `kernel/formatter.go`
**æè¿°**: 
1.  **å­—æ®µæ‰©å±•**: åœ¨ `market.Data` ç»“æ„ä½“ä¸­æ–°å¢ `PriceChange15m` å­—æ®µã€‚
2.  **è®¡ç®—é€»è¾‘**: åœ¨ `market/data.go` ä¸­å®ç°äº†åŸºäºæœ€è¿‘ 5 æ ¹ 3m K çº¿çš„æ¶¨è·Œå¹…è®¡ç®—é€»è¾‘ã€‚
3.  **Prompt å‘ˆç°**: åœ¨ Prompt ä¸­æ˜ç¡®å±•ç¤º `15m Change`ï¼Œä¸º AI åˆ¤æ–­â€œæ¶æ€§æš´è·Œâ€æä¾›ç²¾ç¡®æ•°å€¼ï¼Œæ¶ˆé™¤äº† AI éœ€è¦ä» K çº¿åˆ—è¡¨è‡ªè¡Œè®¡ç®—è€Œäº§ç”Ÿçš„å¹»è§‰é£é™©ã€‚

## 7. Configuration-Driven Architecture (V1.1.0)
- **Goal**: Enable zero-code strategy iteration by driving data generation via `strategy.json`.
- **Files**: `market/types.go`, `market/data.go`, `kernel/engine.go`, `kernel/formatter.go`, `kernel/schema.go`
- **Details**:
  1. **Dynamic Data**: `market.Data` now supports `PriceChanges` (Map), `DynamicEMAs` (Map), `DynamicATRs` (Map).
  2. **Config Driven**: `GetWithTimeframes` accepts `emaPeriods` and `selected_timeframes` from config.
  3. **Formatter**: Automatically iterates maps to generate Prompt (e.g. `EMA60: ...`).
  4. **Schema**: Updated System Prompt to define `Change_{tf}`, `EMA{period}`, `ATR{period}` with Chinese support.
- **Reference**: See complete documentation in [CONFIGURATION_DRIVEN.md](CONFIGURATION_DRIVEN.md)


